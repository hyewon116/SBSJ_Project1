<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MdMapper">
	
	
	<insert id="coupon_insert" parameterType="kr.co.sbsj.md.CouponDTO">
	INSERT INTO coupon (member_id, coupon_name, coupon_dis, coupon_end) 
		VALUES( #{member_id}, #{coupon_name}, #{coupon_dis}, #{coupon_end} )
	</insert>
	
	<select id="couponCheck" parameterType="kr.co.sbsj.md.CouponDTO" resultType="int">
	select count(coupon_id)
	from coupon
	where member_id = #{member_id} and coupon_name = #{coupon_name}

	</select>

	<select id="detail" parameterType="java.lang.String" resultType="kr.co.sbsj.md.MdDTO">
		select md_id, md_name, md_oneline, md_price, md_category, md_abv, md_discount
		, truncate( md_price - (md_price / 100 * md_discount), 0 ) sale_price
		, md_content, md_thumbnail_name, md_thumbnail_path, md_detail_name,
		md_detail_path, md_content, md_standard_stock, md_sales_rate, md_stock
		, md_sweet, md_sour, md_sparkling, md_use, md_ratingAvg
    	from md
		where md_id = #{md_id}
	</select>
	
	<select id="selectList2" parameterType="kr.co.sbsj.util.dto.SearchDTO"
			resultType="kr.co.sbsj.md.MdDTO">
		select md_id, md_name, md_oneline, md_price, md_category, md_abv, md_discount
		, truncate( md_price - (md_price / 100 * md_discount), 0 ) sale_price
		, md_content, md_thumbnail_name, md_thumbnail_path, md_detail_name,
		md_detail_path, md_content, md_standard_stock, md_sales_rate, md_stock
		, md_sweet, md_sour, md_sparkling, md_use, md_ratingAvg, md_onsale
    	from md
		<if test="md_category != null and md_category != ''">
			where md_category = #{md_category} and md_onsale = "Y"
		</if>
		<if test="md_sweet != null and md_sweet != ''">
			where md_sweet = #{md_sweet} and md_onsale = "Y"
		</if>
		<if test="md_sour != null and md_sour != ''">
			where md_sour = #{md_sour} and md_onsale = "Y"
		</if>
		<if test="md_sparkling != null and md_sparkling != ''">
			where md_sparkling = #{md_sparkling} and md_onsale = "Y"
		</if>
		<if test="md_use != null and md_use != ''">
			where md_use = #{md_use} and md_onsale = "Y"
		</if>

		order by md_id desc
		limit #{limitNum}, 4
	</select>

	<select id="searchListCount2" parameterType="kr.co.sbsj.util.dto.SearchDTO" resultType="int">
		select count(md_id) cnt
		from md
		where md_category = #{md_category} and md_onsale = "Y"
	</select>

	<select id="selectList" parameterType="kr.co.sbsj.util.dto.SearchDTO"
			resultType="kr.co.sbsj.md.MdDTO">
		select md_id, md_name, md_oneline, md_price, md_category, md_abv, md_discount
		, truncate( md_price - (md_price / 100 * md_discount), 0 ) sale_price
		, md_content, md_thumbnail_name, md_thumbnail_path, md_detail_name,
		md_detail_path, md_content, md_standard_stock, md_sales_rate, md_stock
		, md_sweet, md_sour, md_sparkling, md_use, #{md_ratingAvg}
    	from md
    	<if test="searchWord != null and searchWord != ''">
			where md_name like concat('%', #{searchWord}, '%') and md_onsale = "Y"
		</if>
		order by md_id desc
		limit #{limitNum}, 4
	</select>

	<select id="searchListCount" parameterType="kr.co.sbsj.util.dto.SearchDTO" resultType="int">
		select count(md_id) cnt
		from md
		<if test="searchWord != null and searchWord != ''">
			where md_name like concat('%', #{searchWord}, '%') and md_onsale = "Y"
		</if>
	</select>

	<insert id="insert" parameterType="kr.co.sbsj.md.MdDTO">
	INSERT INTO md (md_name, md_oneline, md_price, md_category, md_abv
						, md_thumbnail_name, md_thumbnail_path, md_detail_name, md_detail_path
						, md_content, md_standard_stock, md_sales_rate, md_stock, md_sweet, md_sour, md_sparkling
						, md_use, md_discount)
	VALUES( #{md_name}, #{md_oneline} , #{md_price}, #{md_category}, #{md_abv}
			, #{md_thumbnail_name}, #{md_thumbnail_path}, #{md_detail_name}, #{md_detail_path}, 
			#{md_content}, #{md_standard_stock}, 0, #{md_standard_stock}, 
			#{md_sweet}, #{md_sour}, #{md_sparkling}, #{md_use}, #{md_discount})
	</insert>
	
	<insert id="wish_insert" parameterType="kr.co.sbsj.util.dto.SearchDTO">
	INSERT INTO wish (md_id, member_id, wish_item, wish_price, wish_date) 
		select #{md_id}, #{member_id}, md_name, md_price, now()
		from md
		where md_id = #{md_id}
	</insert>
	
	<select id="wishCheck" parameterType="kr.co.sbsj.util.dto.SearchDTO" resultType="int">
	select count(md_id)
	from wish
	where member_id = #{member_id} and md_id = #{md_id}

	</select>

</mapper>
